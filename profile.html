<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trade World - My Profile</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        /* [Previous CSS styles remain exactly the same] */
    </style>
</head>
<body>
    <!-- [Previous HTML structure remains exactly the same until the referral box section] -->
    
    <!-- Only the referral box section needs modification -->
    <div class="referral-box">
        <h3 class="referral-title">Your Referral Link</h3>
        <div class="referral-input">
            <input type="text" id="referralLink" readonly>
            <button id="copyReferralBtn"><i class="fas fa-copy"></i></button>
        </div>
    </div>

    <!-- [Rest of the HTML remains exactly the same] -->

    <script>
        // [Previous Firebase configuration and initialization remains the same]

        // Load user data from Firebase - MODIFIED TO INCLUDE PROPER REFERRAL LINK
        function loadUserData(userId) {
            database.ref('users/' + userId).on('value', (snapshot) => {
                if (!snapshot.exists()) {
                    // Create user data if it doesn't exist
                    const newUserData = {
                        fullName: currentUser.displayName || "New User",
                        email: currentUser.email,
                        mobileNumber: "",
                        balance: 0,
                        joinDate: new Date().toISOString(),
                        referralId: userId // Store the user ID as referral ID
                    };
                    database.ref('users/' + userId).set(newUserData);
                    userData = newUserData;
                } else {
                    userData = snapshot.val();
                    // Ensure referralId exists in user data
                    if (!userData.referralId) {
                        database.ref('users/' + userId).update({ referralId: userId });
                    }
                }
                
                // [Previous profile data loading remains the same]
                
                // Set referral link - THIS IS THE IMPORTANT CHANGE
                const websiteUrl = "https://tradworld7.github.io/mony/";
                const referralUrl = `${websiteUrl}signup.html?ref=${userData.referralId || userId}`;
                document.getElementById('referralLink').value = referralUrl;
                
                // [Rest of the function remains the same]
            }, (error) => {
                showToast('Error loading user data: ' + error.message, 'error');
            });
        }

        // [Rest of the JavaScript remains exactly the same]
    </script>
</body>
</html>
